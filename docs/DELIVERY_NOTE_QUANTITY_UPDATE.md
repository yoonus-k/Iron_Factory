# ๐ฆ ุชุญุฏูุซ ุงููููุฉ ุนูุฏ ุงูุฃุฐู ุงููุงุฑุฏุฉ (Incoming Delivery Notes)

## ุงููุดููุฉ ุงูุฃุตููุฉ ๐ด
ุงููููุฉ ุงููุญููุธุฉ ูู ุงูุฃุฐู ุงููุงุฑุฏุฉ **ูุง ูุงูุช ุชูุนูุณ ุนูู ุฌุฏูู MaterialDetail**. 

ูุนูู ุนูุฏูุง ุชุณุฌู ุฃุฐู ูุงุฑุฏุฉ ุจู 100 ููููุ ุงููููุฉ ูุง ุชุฒูุฏ ูู ุงููุณุชูุฏุน.

---

## ุงูุญู ๐ข

### 1๏ธโฃ ุนูุฏ ุฅุถุงูุฉ ุฃุฐู ูุงุฑุฏุฉ ุฌุฏูุฏุฉ (Store Method)

#### โ ูุง ุงูุฐู ูุญุฏุซ ุงูุขู:

```php
// ูู DeliveryNoteController.php - store() method
if ($type === 'incoming') {
    // ... ุฅุนุฏุงุฏุงุช ุงูุฃุฐู ...
    
    // ุชุญุฏูุซ ุงููููุฉ ูู MaterialDetail
    $materialDetail = \App\Models\MaterialDetail::firstOrCreate(
        [
            'warehouse_id' => $validated['warehouse_id'],
            'material_id' => $validated['material_id'],
        ]
    );
    
    // ุฒูุงุฏุฉ ุงููููุฉ
    $quantityToAdd = $validated['invoice_weight'] ?? $validated['actual_weight'] ?? 0;
    $materialDetail->addIncomingQuantity($quantityToAdd, ...);
}
```

#### ุงููุชูุฌุฉ:
โ ุงููููุฉ **ุชุฒูุฏ ุชููุงุฆูุงู** ูู ุฌุฏูู `material_details`  
โ ูุชู ุฅูุดุงุก record ุฌุฏูุฏ ูู `material_details` ุฅุฐุง ูู ููู ููุฌูุฏ  
โ ูุชู ุชุณุฌูู ุงูุนูููุฉ ูู ููู ุงูุณุฌูุงุช (Log)

---

### 2๏ธโฃ ุนูุฏ ุชุนุฏูู ุฃุฐู ูุงุฑุฏุฉ (Update Method)

#### โ ูุง ุงูุฐู ูุญุฏุซ ุงูุขู:

```php
// ูู DeliveryNoteController.php - update() method
if ($type === 'incoming') {
    // ุญุณุงุจ ุงููุฑู ุจูู ุงููููุฉ ุงูุฌุฏูุฏุฉ ูุงููุฏููุฉ
    $oldQuantity = $oldValues['invoice_weight'] ?? 0;
    $newQuantity = $validated['invoice_weight'] ?? 0;
    $quantityDifference = $newQuantity - $oldQuantity;
    
    // ุชุทุจูู ุงููุฑู
    if ($quantityDifference > 0) {
        $materialDetail->addIncomingQuantity($quantityDifference, ...); // ุฅุถุงูุฉ
    } else if ($quantityDifference < 0) {
        $materialDetail->quantity += $quantityDifference; // ุฎุตู
        $materialDetail->save();
    }
}
```

#### ุงููุชูุฌุฉ:
โ ุฅุฐุง **ุฒุงุฏุช ุงููููุฉ** ูู ุงูุชุนุฏูู โ ุชุฒูุฏ ุงููุงุฏุฉ  
โ ุฅุฐุง **ููุตุช ุงููููุฉ** ูู ุงูุชุนุฏูู โ ุชููุต ุงููุงุฏุฉ  
โ ุงููุฑู ููุทุจู ุจุฏูุฉ ุนูู ุงููููุฉ ุงูููุฌูุฏุฉ

---

### 3๏ธโฃ ุนูุฏ ุญุฐู ุฃุฐู ูุงุฑุฏุฉ (Destroy Method)

#### โ ูุง ุงูุฐู ูุญุฏุซ ุงูุขู:

```php
// ูู DeliveryNoteController.php - destroy() method
if ($deliveryNote->type === 'incoming') {
    // ุงุณุชุฑุฌุงุน ุงููููุฉ ูู ุงููุณุชูุฏุน
    $materialDetail = \App\Models\MaterialDetail::where([
        'warehouse_id' => $deliveryNote->warehouse_id,
        'material_id' => $deliveryNote->material_id,
    ])->first();
    
    if ($materialDetail) {
        $quantityToRemove = $deliveryNote->invoice_weight ?? 0;
        $materialDetail->quantity -= $quantityToRemove;
        $materialDetail->save();
    }
}
```

#### ุงููุชูุฌุฉ:
โ ุนูุฏ ุญุฐู ุงูุฃุฐู โ **ุงููููุฉ ุชููุต** ูู MaterialDetail  
โ ูุนูุฏ ุงููุณุชูุฏุน ุฅูู ุญุงูุชู ุงูุฃุตููุฉ  
โ ูุชู ุชุณุฌูู ุงูุนูููุฉ ูู ุงูุณุฌูุงุช

---

## ุงูููุงุฑูุฉ ูุจู ูุจุนุฏ ๐

| ุงูุนูููุฉ | ูุจู ุงูุชุญุฏูุซ โ | ุจุนุฏ ุงูุชุญุฏูุซ โ |
|--------|-------------|------------|
| ุฅุถุงูุฉ ุฃุฐู ูุงุฑุฏุฉ | ุงููููุฉ ูุง ุชูุนูุณ ุนูู MaterialDetail | ุงููููุฉ ุชุฒูุฏ ุชููุงุฆูุงู |
| ุชุนุฏูู ูููุฉ ุงูุฃุฐู | ุงููุฑููุงุช ูุง ุชูุญุฏูุซ | ุงููุฑู ููุทุจู ุจุฏูุฉ |
| ุญุฐู ุฃุฐู ูุงุฑุฏุฉ | ุงููููุฉ ุชุจูู ูุญุชูุธุฉ ุจู | ุงููููุฉ ุชูุณุชุฑุฌุน ูููุณุชูุฏุน |
| ุฅูุดุงุก MaterialDetail | ูุฌุจ ุฅูุดุงุก ูุฏูู | ููุดุฃ ุชููุงุฆูุงู ูุน ุงูุฃุฐู |

---

## ูุซุงู ุนููู ๐ก

### ุงูุณููุงุฑูู:
1. ุงููุณุชูุฏุน ุญุงููุงู: **0 ูููู** ูู ุงููุงุฏุฉ X
2. ุชุณุฌูู ุฃุฐู ูุงุฑุฏุฉ: **100 ูููู** ูู ุงููุงุฏุฉ X

### ูุจู ุงูุชุญุฏูุซ:
```
MaterialDetail quantity = 0 ูููู โ
```

### ุจุนุฏ ุงูุชุญุฏูุซ:
```
MaterialDetail quantity = 100 ูููู โ
```

### ุงูุณููุงุฑูู 2: ุงูุชุนุฏูู
ุชุนุฏูู ุงูุฃุฐู ูู 100 โ 150 ูููู

### ุจุนุฏ ุงูุชุนุฏูู:
```
MaterialDetail quantity = 150 ูููู โ
(ุงููุฑู +50 ุชู ุฅุถุงูุชู)
```

### ุงูุณููุงุฑูู 3: ุงูุญุฐู
ุญุฐู ุงูุฃุฐู

### ุจุนุฏ ุงูุญุฐู:
```
MaterialDetail quantity = 0 ูููู โ
(ุงููููุฉ ุชู ุงุณุชุฑุฌุงุนูุง)
```

---

## ุงููููุงุช ุงููุนุฏููุฉ ๐

### 1. DeliveryNoteController.php
- **store()**: ุฅุถุงูุฉ ุชุญุฏูุซ ุงููููุฉ ููุฃุฐู ุงููุงุฑุฏุฉ ุงูุฌุฏูุฏุฉ
- **update()**: ุฅุถุงูุฉ ุญุณุงุจ ุงููุฑู ูุชุทุจููู
- **destroy()**: ุฅุถุงูุฉ ุงุณุชุฑุฌุงุน ุงููููุฉ ุนูุฏ ุงูุญุฐู

### 2. MaterialDetail.php (ููุฌูุฏ ูุณุจูุงู)
- ุฏุงูุฉ `addIncomingQuantity()` - ุชุฒูุฏ ุงููููุฉ
- ุฏุงูุฉ `reduceOutgoingQuantity()` - ุชููุต ุงููููุฉ

---

## ููุงุญุธุงุช ูููุฉ โ๏ธ

1. **ุงููููุงุช ุงููุณุชุฎุฏูุฉ:**
   - ููุฃุฐู ุงููุงุฑุฏุฉ: `invoice_weight` (ุงูุฃููููุฉ) ุฃู `actual_weight`
   - ููุฃุฐู ุงูุตุงุฏุฑุฉ: `delivery_quantity` (ูุชู ูุนุงูุฌุชูุง ุจุดูู ูููุตู)

2. **ุงูุชุณุฌูู:**
   - ุฌููุน ุงูุนูููุงุช ุชูุณุฌู ูู ููู `storage/logs/laravel.log`
   - ุงูุจุญุซ ุนู "โ" ุฃู "โ๏ธ" ูููุฑุงุฌุนุฉ

3. **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:**
   - ุฅุฐุง ูุดู ุชุญุฏูุซ ุงููููุฉุ ุงูุนูููุฉ **ูุง ุชุชููู**
   - ูุชู ุชุณุฌูู ุงูุฎุทุฃ ููุท (ูุง ูุญุฐู ุงูุฃุฐู)

4. **ุงูุฃุฐู ุงูุตุงุฏุฑุฉ:**
   - ูุง ุชุชุฃุซุฑ ุจูุฐุง ุงูุชุญุฏูุซ
   - ููุง ูุนุงูุฌุฉ ูููุตูุฉ ูู `MaterialMovement`

---

## ุงูุงุฎุชุจุงุฑ ๐งช

### ููุชุญูู ูู ุฃู ุงููููุฉ ุชู ุชุญุฏูุซูุง:

```bash
# ูู Tinker
php artisan tinker

# ุชุญูู ูู ุงููููุฉ
$material = \App\Models\MaterialDetail::where('material_id', 1)->where('warehouse_id', 1)->first();
echo $material->quantity; // ูุฌุจ ุฃู ุชุนูุณ ุขุฎุฑ ุนูููุฉ

# ุชุญูู ูู ุงูุณุฌูุงุช
\Illuminate\Support\Facades\Log::info('test');
```

---

## ุงูุฎูุงุตุฉ ๐ฏ

โ **ุงูุขู ุงููููุงุช ุชูุนูุณ ุจุดูู ุตุญูุญ ุนูู MaterialDetail**  
โ **ุงูุชุนุฏููุงุช ุชุญุฏุซ ุงููุฑููุงุช ุจุฏูุฉ**  
โ **ุงูุญุฐู ูุณุชุฑุฌุน ุงููููุงุช**  
โ **ูู ุงูุนูููุงุช ูุณุฌูุฉ ูุขููุฉ**

