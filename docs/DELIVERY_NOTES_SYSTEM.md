# ๐ฆ ูุธุงู ุฃุฐูู ุงูุชุณููู ุงูููุญุฏ - Unified Delivery Notes System

## ูุธุฑุฉ ุนุงูุฉ - Overview

ุชู ุชุทููุฑ ูุธุงู ุฃุฐูู ุชุณููู ููุญุฏ ูุฏุนู ูู ูู **ุฃุฐูู ุงูุงุณุชูุจุงู ุงููุงุฑุฏุฉ** (ูู ุงูููุฑุฏูู) ู **ุฃุฐูู ุงูุชุณููู ุงูุตุงุฏุฑุฉ** (ููุฒุจุงุฆู) ูู ููุณ ุงููุธุงู.

A unified delivery notes system has been implemented to support both **incoming delivery notes** (from suppliers) and **outgoing delivery notes** (to customers) in a single system.

---

## ๐ฏ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ - Key Features

### 1. **ููุน ุงูุฃุฐู ุงููุฑู - Flexible Note Type**
- ๐ฝ **ุฃุฐู ูุงุฑุฏุฉ (Incoming)**: ุงุณุชูุจุงู ููุงุฏ ูู ุงูููุฑุฏูู
- ๐ผ **ุฃุฐู ุตุงุฏุฑุฉ (Outgoing)**: ุชุณููู ููุงุฏ ููุฒุจุงุฆู
- ุงููููุฐุฌ ูุชููู ุชููุงุฆูุงู ุจูุงุกู ุนูู ููุน ุงูุฃุฐู ุงููุฎุชุงุฑ

### 2. **ุชุณุฌูู ุงูุฃูุฒุงู ุงููุนููุฉ - Actual Weight Recording**
- ุชุณุฌูู ุงููุฒู ุงููุนูู ูู ุงูููุฒุงู ุจุดูู ูููุตู
- ุชุณุฌูู ูุฒู ุงููุงุชูุฑุฉ (ุงุฎุชูุงุฑู) ููููุงุฑูุฉ
- **ุญุณุงุจ ุชููุงุฆู ููุฑู ุงูุฃูุฒุงู** (ุงููุนูู - ุงููุงุชูุฑุฉ)
- ูุณุงุนุฏ ูู ูุดู ุงูุงุฎุชูุงูุงุช ูุน ุงูููุฑุฏูู

### 3. **ุจูุงูุงุช ูุฎุตุตุฉ ููููุน - Type-Specific Data**

#### ููุฃุฐู ุงููุงุฑุฏุฉ (Incoming):
- ุงุฎุชูุงุฑ ุงูููุฑุฏ
- ุจูุงูุงุช ุงูุณุงุฆู ูุงุณูู
- ุฑูู ุงููุฑูุจุฉ
- ุฑูู ูุฑุฌุน ุงููุงุชูุฑุฉ ูู ุงูููุฑุฏ

#### ููุฃุฐู ุงูุตุงุฏุฑุฉ (Outgoing):
- ุงุฎุชูุงุฑ ุงููุณุชูุฏุน/ุงููุฌูุฉ
- ุงุฎุชูุงุฑ ุงููุณุชูุจู/ุงูููุธู
- ูุนูููุงุช ุงูุชุณููู

### 4. **ูุธุงู ุงูุชุณุฌูู ุบูุฑ ุงููุญุฌูุจ - Non-Blocking Logging**
- ุชุณุฌูู ุงูุนูููุงุช ูุง ูุคุซุฑ ุนูู ุฅุชูุงู ุงูุนูููุฉ ุงูุฃุณุงุณูุฉ
- ุฅุฐุง ุญุฏุซ ุฎุทุฃ ูู ุงูุชุณุฌููุ ุงูุนูููุฉ ุชูุชูู ููู ูุชู ุชุณุฌูู ุงูุฎุทุฃ
- ุถูุงู ุนุฏู ููุฏุงู ุงูุจูุงูุงุช

### 5. **ุฅุถุงูุฉ ุชูุงุตูู ุงููุงุชูุฑุฉ ูุงุญูุงู - Add Invoice Details Later**
- ูููู ุฅูุดุงุก ุงูุฃุฐู ุจุฏูู ูุงุชูุฑุฉ
- ูููู ุฅุถุงูุฉ ุชูุงุตูู ุงููุงุชูุฑุฉ ูุงุญูุงู ูู ูุจู ุงููุญุงุณุจ
- ุทุฑููุฉ ูููุตูุฉ: `addInvoiceDetails()`

---

## ๐ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช - Database Schema

### ุฌุฏูู `delivery_notes`

```sql
CREATE TABLE delivery_notes (
    id BIGINT PRIMARY KEY,
    note_number VARCHAR(100) UNIQUE,
    type ENUM('incoming', 'outgoing') DEFAULT 'incoming',
    material_id BIGINT,
    
    -- Weight Information
    delivered_weight DECIMAL(10, 3),        -- ุงููุฒู ุงููุณูู
    actual_weight DECIMAL(10, 3),           -- ุงููุฒู ุงููุนูู ูู ุงูููุฒุงู
    invoice_weight DECIMAL(10, 3),          -- ูุฒู ุงููุงุชูุฑุฉ
    weight_discrepancy DECIMAL(10, 3),      -- ุงููุฑู (ูุนูู - ูุงุชูุฑุฉ)
    
    -- Delivery Information
    delivery_date DATE,
    driver_name VARCHAR(255),
    driver_name_en VARCHAR(255),
    vehicle_number VARCHAR(50),
    
    -- Users
    received_by BIGINT,                     -- ูู ุงุณุชูุจู/ุชุณูู
    recorded_by BIGINT,                     -- ูู ุณุฌู ุงูุฃุฐู
    approved_by BIGINT,                     -- ูู ูุงูู
    
    -- Supplier (for incoming)
    supplier_id BIGINT,
    
    -- Destination (for outgoing)
    destination_id BIGINT,
    
    -- Invoice Details
    invoice_number VARCHAR(100),
    invoice_reference_number VARCHAR(100),
    approved_at TIMESTAMP,
    
    -- Status
    is_active BOOLEAN DEFAULT true,
    
    -- Timestamps
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

---

## ๐ ุงูุนูุงูุงุช - Relationships

### DeliveryNote Model
```php
// Material
deliveryNote->material()

// Users
deliveryNote->receiver()         // ูู ุงุณุชูุจู ุงูุฃุฐู
deliveryNote->recordedBy()       // ูู ุณุฌู ุงูุฃุฐู
deliveryNote->approvedBy()       // ูู ูุงูู ุนูู ุงูุฃุฐู

// Supplier (ููุฃุฐู ุงููุงุฑุฏุฉ)
deliveryNote->supplier()

// Destination Warehouse (ููุฃุฐู ุงูุตุงุฏุฑุฉ)
deliveryNote->destination()
```

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู - User Interface

### ูููุฐุฌ ุงูุฅูุดุงุก - Create Form

#### 1. ุงุฎุชูุงุฑ ุงูููุน - Type Selection
```
โ ุฃุฐู ูุงุฑุฏุฉ (ูู ุงูููุฑุฏ)
โ ุฃุฐู ุตุงุฏุฑุฉ (ููุฒุจูู)
```

#### 2. ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ - Basic Information
- ุฑูู ุงูุฃุฐู (ูุฑูุฏ)
- ุงูุชุงุฑูุฎ
- ุงููุงุฏุฉ

#### 3. ูุนูููุงุช ุงูุฃูุฒุงู - Weight Information
- ุงููุฒู ุงููุนูู ูู ุงูููุฒุงู (ุฅุฌุจุงุฑู)
- ูุฒู ุงููุงุชูุฑุฉ (ุงุฎุชูุงุฑู)
- ุงููุฑู ููุญุณุจ ุชููุงุฆูุงู

#### 4. ุงูุจูุงูุงุช ุงููุฎุตุตุฉ - Type-Specific Fields
**ููุฃุฐู ุงููุงุฑุฏุฉ:**
- ุงูููุฑุฏ (ุฅุฌุจุงุฑู)
- ุงุณู ุงูุณุงุฆู
- ุฑูู ุงููุฑูุจุฉ
- ุฑูู ูุฑุฌุน ุงููุงุชูุฑุฉ

**ููุฃุฐู ุงูุตุงุฏุฑุฉ:**
- ุงููุณุชูุฏุน/ุงููุฌูุฉ (ุฅุฌุจุงุฑู)
- ุงููุณุชูุจู

---

## ๐ป API ูุงููุณุงุฑุงุช - Routes & API

### ุงููุณุงุฑุงุช ุงูุฃุณุงุณูุฉ - Basic Routes

```php
// ุฅูุดุงุก ุฃุฐู ุฌุฏูุฏุฉ
POST   /delivery-notes

// ุนุฑุถ ูุงุฆูุฉ ุงูุฃุฐูู
GET    /delivery-notes

// ุนุฑุถ ุฃุฐู ูุญุฏุฏุฉ
GET    /delivery-notes/{id}

// ุชุนุฏูู ุฃุฐู
PUT    /delivery-notes/{id}

// ุญุฐู ุฃุฐู
DELETE /delivery-notes/{id}

// ุชุบููุฑ ุงูุญุงูุฉ (ููุนูุฉ/ูุนุทูุฉ)
PUT    /delivery-notes/{id}/toggle-status

// ุฅุถุงูุฉ ุชูุงุตูู ุงููุงุชูุฑุฉ
POST   /delivery-notes/{id}/add-invoice-details
```

---

## ๐ง ุงููุชุบูุฑุงุช ูุงูุนูููุงุช - Methods & Operations

### ูู ูููุฐุฌ DeliveryNote

```php
// ุงูุชุญูู ูู ููุน ุงูุฃุฐู
$deliveryNote->isIncoming()    // true ุฅุฐุง ูุงูุช ูุงุฑุฏุฉ
$deliveryNote->isOutgoing()    // true ุฅุฐุง ูุงูุช ุตุงุฏุฑุฉ

// ุญุณุงุจ ุงููุฑู
$deliveryNote->calculateDiscrepancy()  // ููุญุณุจ ุชููุงุฆูุงู ุนูุฏ ุงูุญูุธ

// ุงูุชุตููุฉ ุญุณุจ ุงูููุน
DeliveryNote::incoming()->get()   // ุฌููุน ุงูุฃุฐูู ุงููุงุฑุฏุฉ
DeliveryNote::outgoing()->get()   // ุฌููุน ุงูุฃุฐูู ุงูุตุงุฏุฑุฉ
```

### ูู ุงูุชุญูู - DeliveryNoteController

```php
// ุชุฎุฒูู ุฃุฐู ุฌุฏูุฏุฉ
store($request)

// ุชุญุฏูุซ ุฃุฐู ููุฌูุฏุฉ
update($request, $id)

// ุญุฐู ุฃุฐู
destroy($id)

// ุชุจุฏูู ุงูุญุงูุฉ
toggleStatus($request, $id)

// ุฅุถุงูุฉ ุชูุงุตูู ุงููุงุชูุฑุฉ ูุงุญูุงู
addInvoiceDetails($request, $id)
```

---

## ๐ ูุซุงู ุนูู ุงูุงุณุชุฎุฏุงู - Usage Example

### ุฅูุดุงุก ุฃุฐู ูุงุฑุฏุฉ - Create Incoming Note
```php
$data = [
    'type' => 'incoming',
    'delivery_number' => 'DN-INC-001-2025',
    'delivery_date' => '2025-11-16',
    'material_id' => 1,
    'actual_weight' => 1000.50,          // ูู ุงูููุฒุงู
    'invoice_weight' => 950.00,          // ูู ุงููุงุชูุฑุฉ
    'supplier_id' => 5,
    'driver_name' => 'ุฃุญูุฏ ูุญูุฏ',
    'vehicle_number' => 'ุฃุจ ุช 1234',
    'invoice_reference_number' => 'INV-2025-5678'
];

$deliveryNote = DeliveryNote::create($data);
// weight_discrepancy ุณููุญุณุจ ุชููุงุฆูุงู: 1000.50 - 950.00 = 50.50
```

### ุฅุถุงูุฉ ุชูุงุตูู ุงููุงุชูุฑุฉ ูุงุญูุงู - Add Invoice Later
```php
$deliveryNote->addInvoiceDetails([
    'invoice_number' => 'INV-25-11-001',
    'invoice_weight' => 950.00
]);
```

---

## ๐ ุงูุชูุงูู ูุน ุงููุธุงู ุงูุฃูุจุฑ - System Integration

### ูุน ูุธุงู ุชุณุฌูู ุงูุนูููุงุช - With Operation Logging

ูู ุนูููุฉ (ุฅูุดุงุกุ ุชุญุฏูุซุ ุญุฐู) ุชูุณุฌู ุชููุงุฆูุงู:
```
- ุงูุนูููุฉ (create, update, delete)
- ุงููุตู (ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ)
- ุงูุจูุงูุงุช ุงูุณุงุจูุฉ ูุงูุฌุฏูุฏุฉ
- ุงููุณุชุฎุฏู ุงูุฐู ูุงู ุจุงูุนูููุฉ
- ุงูุชูููุช
```

### ูุน ูุธุงู ุงูุฃุฐููุงุช - With Permission System

ูููู ุฅุถุงูุฉ ุฃุฐููุงุช:
```php
Route::resource('delivery-notes', DeliveryNoteController::class)
    ->middleware('can:manage-delivery-notes');
```

---

## ๐ ุงูุชูุงุฑูุฑ ุงููุญุชููุฉ - Potential Reports

### 1. **ุชูุฑูุฑ ูุฑููุงุช ุงูุฃูุฒุงู - Weight Discrepancy Report**
ูุธูุฑ:
- ุงูุฃุฐูู ุฐุงุช ุงููุฑููุงุช ุงูุนุงููุฉ
- ุงูููุฑุฏูู ุงูุฐูู ูุฏููู ูุฑููุงุช ูุชูุฑุฑุฉ
- ุฅุฌูุงูู ุงููุฑููุงุช ุญุณุจ ุงูููุฑุฏ

### 2. **ุชูุฑูุฑ ุงูุฃุฐูู ุงููุนููุฉ - Pending Notes Report**
ูุธูุฑ:
- ุงูุฃุฐูู ุงูุชู ูู ุชูููุงูู ุนูููุง ุจุนุฏ
- ุงูุฃุฐูู ุงููุนุทูุฉ
- ุงูุฃุฐูู ุงูุฌุฏูุฏุฉ

### 3. **ุชูุฑูุฑ ุงูุฃุฏุงุก - Performance Report**
ูุธูุฑ:
- ุนุฏุฏ ุงูุฃุฐูู ุงููุงุฑุฏุฉ ูุงูุตุงุฏุฑุฉ
- ุณุฑุนุฉ ุงููุนุงูุฌุฉ
- ูุนุฏู ุงูุฃุฎุทุงุก

---

## ๐ ุฃูุงู ุงููุธุงู - Security

### ุงูุชุญูู ูู ุงูุจูุงูุงุช - Validation
```php
'type' => 'required|in:incoming,outgoing',
'actual_weight' => 'required|numeric|gt:0',
'supplier_id' => $type === 'incoming' ? 'required|exists:suppliers,id' : 'nullable',
'destination_id' => $type === 'outgoing' ? 'required|exists:warehouses,id' : 'nullable',
```

### ุงูุชุณุฌูู - Logging
- ูู ุนูููุฉ ุชูุณุฌู ูุน ุจูุงูุงุช ุงููุณุชุฎุฏู
- ูููู ุชุชุจุน ูู ุบููุฑ ูุงุฐุง ููุชู

---

## ๐ ุงููุนุงูุฌุฉ ุงูุฎุงุตุฉ ุจุงูุฃุฎุทุงุก - Error Handling

ุฌููุน ุงูุฃุฎุทุงุก ูุญุจููุฉ ูู try-catch blocks:
```php
try {
    // ุงูุนูููุฉ ุงูุฃุณุงุณูุฉ
    $deliveryNote->save();
    
} catch (Exception $e) {
    // ุชุณุฌูู ุงูุฎุทุฃ ุจุฏูู ุฅููุงู ุงูุนูููุฉ
    Log::error('Delivery note save failed: ' . $e->getMessage());
    return redirect()->back()->with('error', 'ูุดู ุญูุธ ุงูุฃุฐู');
}
```

---

## ๐ ุงููุชุทูุจุงุช ุงููุณุชูุจููุฉ - Future Requirements

### ุงููุฑุญูุฉ 2 - Phase 2

1. **ูุธุงู ุงูููุงููุฉ** - Approval Workflow
   - ููุงููุฉ ุงููุดุฑู ููุฃุฐูู ุงููุงุฑุฏุฉ
   - ููุงููุฉ ูุฏูุฑ ุงูุฅูุชุงุฌ ููุฃูุฒุงู ุงูุนุงููุฉ

2. **ุงูุชูุงูู ูุน ุงููุธุงู ุงููุญุงุณุจู** - Accounting Integration
   - ุชุตุฏูุฑ ุงูุจูุงูุงุช ูููุธุงู ุงููุญุงุณุจู
   - ุชุณููุฉ ุงูุญุณุงุจุงุช

3. **ุงูุชูุงุฑูุฑ ุงููุชูุฏูุฉ** - Advanced Reports
   - ุชูุงุฑูุฑ ุงูุฃุฏุงุก
   - ุชุญููู ุงูููุฑุฏูู
   - ุชููุนุงุช ุงูุงุญุชูุงุฌุงุช

4. **ุงูุชูุจููุงุช** - Alerts
   - ุชูุจููุงุช ุงููุฑููุงุช ุงูุนุงููุฉ
   - ุชูุจููุงุช ุงูุชุฃุฎูุฑ
   - ุชูุจููุงุช ุงูููุฑุฏูู ุงููุชูุฑุฑูู

---

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ - Support

ูููุฒูุฏ ูู ุงููุนูููุงุช ุฃู ุงูุฏุนู:
- ุชุญูู ูู ููู `README.md`
- ุฑุงุฌุน ุฏููู ุงููุณุชุฎุฏู
- ุชูุงุตู ูุน ูุฑูู ุงูุชุทููุฑ

---

**ุขุฎุฑ ุชุญุฏูุซ:** 16 ููููุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0  
**ุงูุญุงูุฉ:** ููุชูู ูุฌุงูุฒ ููุงุณุชุฎุฏุงู โ
