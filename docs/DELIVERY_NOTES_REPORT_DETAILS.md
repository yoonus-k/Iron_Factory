# تقرير أذون التسليم المتقدم - شرح مفصل

## نظرة عامة
تم تطوير تقرير أذون التسليم ليوفر رؤية شاملة وتفاعلية لجميع أذون التسليم مع إحصائيات متقدمة ورسوم بيانية توضيحية.

---

## المميزات الرئيسية

### 1. **الإحصائيات الأساسية (Main Statistics Cards)**
عرض الأرقام والإحصائيات الرئيسية مع نسب مئوية:
- **إجمالي الأذون**: عدد جميع أذون التسليم في الفترة المحددة
- **قيد الانتظار**: عدد الأذون التي لم تتم معالجتها بعد مع النسبة المئوية
- **موافق عليه**: عدد الأذون المعتمدة مع النسبة المئوية
- **مكتمل**: عدد الأذون المنتهية مع النسبة المئوية
- **مرفوض**: عدد الأذون المرفوضة مع النسبة المئوية
- **إجمالي الكمية**: مجموع الكميات مع المتوسط

### 2. **الإحصائيات الثانوية (Secondary Statistics)**
معلومات إضافية مهمة:
- **الحركات الواردة (Incoming)**: عدد أذون الاستقبال
- **الحركات الصادرة (Outgoing)**: عدد أذون الإصدار
- **إجمالي الوزن**: مجموع الأوزان بالكيلوجرام
- **متوسط الوزن**: متوسط وزن الأذن الواحدة

### 3. **الرسوم البيانية (Charts)**

#### أ. توزيع حالات الأذون (Doughnut Chart)
- رسم بياني دائري يوضح نسبة توزيع الأذون حسب الحالة
- الألوان:
  - برتقالي: قيد الانتظار
  - أخضر: موافق عليه
  - أزرق: مكتمل
  - أحمر: مرفوض

#### ب. توزيع نوع الحركات (Doughnut Chart)
- رسم بياني دائري يوضح نسبة الحركات الواردة والصادرة
- الألوان:
  - أزرق: حركات واردة
  - بنفسجي: حركات صادرة

#### ج. الاتجاهات اليومية (Line Chart)
- رسم بياني خطي يوضح:
  - عدد الأذون يومياً (المحور الأيسر)
  - إجمالي الكمية يومياً (المحور الأيمن)
- يساعد في تتبع الأنماط والاتجاهات

### 4. **أفضل 10 موردين**
جدول أو شبكة تعرض:
- ترتيب المورد من 1 إلى 10
- اسم المورد
- عدد الأذون المسجلة له
- إجمالي الكمية المسلمة منه

### 5. **إحصائيات المستودعات**
جدول يوضح:
- اسم المستودع
- عدد الأذون المستقبلة
- إجمالي الكمية
- شريط تقدم (Progress Bar) يعرض النسبة المئوية

### 6. **جدول التفاصيل الكامل**
جدول شامل يحتوي على:
- **رقم الإذن**: معرّف فريد لكل أذن
- **المورد**: اسم المورد المرسل
- **المستودع**: المستودع المستقبل
- **النوع**: واردة أو صادرة
- **تاريخ التسليم**: يوم استقبال الأذن
- **الكمية**: كمية المواد المسلمة
- **الوزن**: الوزن بالكيلوجرام
- **المسجل بواسطة**: اسم الموظف الذي سجل الأذن
- **الحالة**: حالة معالجة الأذن

---

## التصفية والبحث

يمكن تصفية التقرير حسب:
1. **من تاريخ - إلى تاريخ**: تحديد نطاق زمني
2. **المورد**: اختيار مورد معين أو الكل
3. **المستودع**: اختيار مستودع معين أو الكل
4. **الحالة**: اختيار حالة محددة أو الكل

---

## الخيارات الإضافية

### الطباعة
- زر الطباعة يسمح بطباعة التقرير مباشرة
- عند الطباعة، يتم إخفاء أزرار الفلترة والتحكم

### تحميل PDF
- إمكانية تحميل التقرير كملف PDF
- بصيغة أفقية وعالية الجودة
- اسم الملف: `تقرير-أذون-التسليم.pdf`

---

## البيانات المحسوبة

### المتوسطات والمجاميع
```php
'total_notes'      // إجمالي الأذون
'pending_notes'    // الأذون المعلقة
'approved_notes'   // الأذون المعتمدة
'completed_notes'  // الأذون المكتملة
'rejected_notes'   // الأذون المرفوضة
'total_quantity'   // إجمالي الكمية
'total_weight'     // إجمالي الوزن
'avg_quantity'     // متوسط الكمية
'avg_weight'       // متوسط الوزن
```

### توزيع النوع
```php
'incoming'  // الحركات الواردة
'outgoing'  // الحركات الصادرة
```

---

## الترقيم والحقول

### حالات الأذون
- `pending`: قيد الانتظار
- `approved`: موافق عليه
- `completed`: مكتمل
- `rejected`: مرفوض

### أنواع الحركات
- `incoming`: واردة (من الموردين)
- `outgoing`: صادرة (إلى الجهات الأخرى)

---

## التوافق

### المتصفحات المدعومة
- Chrome / Chromium
- Firefox
- Safari
- Edge

### الأجهزة
- سطح المكتب
- الأجهزة اللوحية
- الهواتف الذكية (مع تصميم مستجيب)

---

## الأداء والسرعة

- الجداول مرقمة: 20 سجل لكل صفحة
- البيانات محملة بكفاءة عبر Eloquent
- الرسوم البيانية تُرسم بـ Chart.js (مكتبة خفيفة وسريعة)

---

## الألوان المستخدمة

| الحالة | اللون | الوصف |
|--------|-------|-------|
| قيد الانتظار | برتقالي `#F39C12` | تحتاج متابعة |
| موافق عليه | أخضر `#27AE60` | تمت الموافقة |
| مكتمل | أزرق `#0066B2` | منتهية |
| مرفوض | أحمر `#e74c3c` | لم تُقبل |

---

## شاشات العرض المختلفة

### على سطح المكتب (Desktop)
- عرض كامل مع جميع الأعمدة والمعلومات
- رسوم بيانية كبيرة وواضحة

### على الهاتف (Mobile)
- عرض مستجيب ومتوافق
- الجداول قابلة للتمرير أفقياً
- الرسوم البيانية تتناسب مع حجم الشاشة

---

## كيفية الوصول

```
Route: manufacturing.warehouse-reports.delivery-notes
URL: /manufacturing/warehouse-reports/delivery-notes
Method: GET
```

---

## ملاحظات التطوير

### في الـ Controller
```php
public function deliveryNotesReport(Request $request)
{
    // الحصول على التواريخ من الطلب أو استخدام القيم الافتراضية
    $startDate = $request->start_date ?? Carbon::now()->subMonth()->format('Y-m-d');
    $endDate = $request->end_date ?? Carbon::now()->format('Y-m-d');
    
    // حسابات الإحصائيات والبيانات
    // ...
    
    return view('manufacturing::warehouses.reports.delivery-notes-report', compact(...));
}
```

### المتغيرات المرسلة للـ View
- `deliveryNotes`: قائمة الأذون مع المعلومات الكاملة
- `stats`: الإحصائيات الأساسية
- `suppliers`: قائمة الموردين النشطين
- `warehouses`: قائمة المستودعات النشطة
- `typeStats`: إحصائيات النوع
- `topSuppliers`: أفضل 10 موردين
- `warehouseStats`: إحصائيات المستودعات
- `dailyTrends`: الاتجاهات اليومية
- `statusDistribution`: توزيع الحالات

---

## التحديثات المستقبلية المحتملة

1. ✓ إضافة تقرير معادلات (Reconciliation Report)
2. ✓ إضافة تقارير وزن مقارن
3. ✓ تقارير عن الاختلافات والأخطاء
4. ✓ تنبيهات تلقائية للأذون المعلقة

---

**آخر تحديث**: November 22, 2025
**الإصدار**: 1.0
