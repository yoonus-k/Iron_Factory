# ๐๏ธ ุฏููู ุงุณุชุฎุฏุงู ุงูู Migrations - ูุธุงู ูุตูุน ุงูุญุฏูุฏ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก 21 ููู migration ููุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูุธุงู ุฅุฏุงุฑุฉ ูุตูุน ุงูุญุฏูุฏุ ุชุบุทู ุฌููุน ุงูุฌุฏุงูู ุงููุทููุจุฉ ูููุธุงู.

---

## ๐ ูุงุฆูุฉ ุงูู Migrations

### 1๏ธโฃ ุฌุฏุงูู ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช (3 ุฌุฏุงูู)
- `2024_01_01_000001_create_users_table.php` - ุฌุฏูู ุงููุณุชุฎุฏููู
- `2024_01_01_000002_create_user_permissions_table.php` - ุตูุงุญูุงุช ุงููุณุชุฎุฏููู
- `2024_01_01_000003_create_shift_assignments_table.php` - ุชุนููู ุงููุฑุฏูุงุช

### 2๏ธโฃ ุฌุฏุงูู ุงููุณุชูุฏุน ูุงูููุฑุฏูู (4 ุฌุฏุงูู)
- `2024_01_01_000004_create_suppliers_table.php` - ุงูููุฑุฏูู
- `2024_01_01_000005_create_purchase_invoices_table.php` - ููุงุชูุฑ ุงููุดุชุฑูุงุช
- `2024_01_01_000006_create_materials_table.php` - ุงูููุงุฏ ุงูุฎุงู (ุงููุณุชูุฏุน)
- `2024_01_01_000007_create_delivery_notes_table.php` - ุฃุฐููุงุช ุงูุชุณููู

### 3๏ธโฃ ุฌุฏุงูู ุงููุฑุงุญู ุงูุฅูุชุงุฌูุฉ (6 ุฌุฏุงูู)
- `2024_01_01_000008_create_stage1_stands_table.php` - ุงููุฑุญูุฉ 1: ุงูุงุณุชุงูุฏุงุช
- `2024_01_01_000009_create_stage2_processed_table.php` - ุงููุฑุญูุฉ 2: ุงููุนุงูุฌุฉ
- `2024_01_01_000010_create_additives_inventory_table.php` - ูุฎุฒูู ุงูุตุจุบุฉ ูุงูุจูุงุณุชูู
- `2024_01_01_000011_create_stage3_coils_table.php` - ุงููุฑุญูุฉ 3: ุงูููููุงุช
- `2024_01_01_000012_create_stage4_boxes_table.php` - ุงููุฑุญูุฉ 4: ุงูุชุนุจุฆุฉ
- `2024_01_01_000013_create_box_coils_table.php` - ุฑุจุท ุงูููููุงุช ุจุงููุฑุงุชูู

### 4๏ธโฃ ุฌุฏุงูู ุงููุฑุงูุจุฉ ูุงูุชุชุจุน (4 ุฌุฏุงูู)
- `2024_01_01_000014_create_waste_limits_table.php` - ุญุฏูุฏ ุงููุฏุฑ ุงููุณููุญุฉ
- `2024_01_01_000015_create_waste_tracking_table.php` - ุชุชุจุน ุงููุฏุฑ
- `2024_01_01_000016_create_shift_handovers_table.php` - ุชุณููู ุงููุฑุฏูุงุช
- `2024_01_01_000017_create_operation_logs_table.php` - ุณุฌู ุงูุนูููุงุช

### 5๏ธโฃ ุฌุฏุงูู ุงูุชูุงุฑูุฑ ูุงูุฅุนุฏุงุฏุงุช (4 ุฌุฏุงูู)
- `2024_01_01_000018_create_generated_reports_table.php` - ุงูุชูุงุฑูุฑ ุงููุญููุธุฉ
- `2024_01_01_000019_create_daily_statistics_table.php` - ุงูุฅุญุตุงุฆูุงุช ุงูููููุฉ
- `2024_01_01_000020_create_system_formulas_table.php` - ุงููุนุงุฏูุงุช ุงููุงุจูุฉ ููุชุฎุตูุต
- `2024_01_01_000021_create_system_settings_table.php` - ุฅุนุฏุงุฏุงุช ุงููุธุงู

---

## ๐ ููููุฉ ุชุดุบูู ุงูู Migrations

### ุงูุทุฑููุฉ 1: ุชุดุบูู ุฌููุน ุงูู Migrations ุฏูุนุฉ ูุงุญุฏุฉ

```bash
php artisan migrate
```

### ุงูุทุฑููุฉ 2: ุชุดุบูู migration ูุญุฏุฏ

```bash
php artisan migrate --path=/database/migrations/2024_01_01_000001_create_users_table.php
```

### ุงูุทุฑููุฉ 3: ุนุฑุถ ุญุงูุฉ ุงูู Migrations

```bash
php artisan migrate:status
```

---

## ๐ ุงูุชุฑุงุฌุน ุนู ุงูู Migrations

### ุงูุชุฑุงุฌุน ุนู ุขุฎุฑ ุฏูุนุฉ ูู ุงูู Migrations

```bash
php artisan migrate:rollback
```

### ุงูุชุฑุงุฌุน ุนู ุนุฏุฏ ูุญุฏุฏ ูู ุงูุฏูุนุงุช

```bash
php artisan migrate:rollback --step=5
```

### ุญุฐู ุฌููุน ุงูุฌุฏุงูู ูุงูุจุฏุก ูู ุฌุฏูุฏ

```bash
php artisan migrate:fresh
```

### ุญุฐู ุฌููุน ุงูุฌุฏุงูู ูุฅุนุงุฏุฉ ุชุดุบูู ุงูู Migrations ูุน ุงูู Seeders

```bash
php artisan migrate:fresh --seed
```

---

## ๐ ุชูุงุตูู ูููุฉ

### 1๏ธโฃ ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ ุงูููุฏุฑุฌุฉ ุชููุงุฆูุงู

#### ุฌุฏูู `waste_limits` (ุญุฏูุฏ ุงููุฏุฑ):
- ุงููุฑุญูุฉ 1: 2% ุญุฏ ุฃูุตูุ 1.5% ุชุญุฐูุฑ
- ุงููุฑุญูุฉ 2: 3% ุญุฏ ุฃูุตูุ 2.5% ุชุญุฐูุฑ
- ุงููุฑุญูุฉ 3: 5% ุญุฏ ุฃูุตูุ 4% ุชุญุฐูุฑ
- ุงููุฑุญูุฉ 4: 1% ุญุฏ ุฃูุตูุ 0.75% ุชุญุฐูุฑ

#### ุฌุฏูู `system_settings` (ุฅุนุฏุงุฏุงุช ุงููุธุงู):
- ุจุงุฏุฆุงุช ุงูุจุงุฑููุฏ: WH, ST1, ST2, CO3, BOX4
- ูุณุจ ุงููุฏุฑ ุงูุงูุชุฑุงุถูุฉ ููู ูุฑุญูุฉ
- ุงุณู ุงูุดุฑูุฉ: ูุตูุน ุงูุญุฏูุฏ ุงูุฐูู
- ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช

#### ุฌุฏูู `system_formulas` (ุงููุนุงุฏูุงุช):
- ูุนุงุฏูุฉ ุญุณุงุจ ุงููุฒู ูููุฑุญูุฉ ุงูุฃููู
- ูุนุงุฏูุฉ ุญุณุงุจ ุงููุฒู ุจุนุฏ ุงููุนุงูุฌุฉ
- ูุนุงุฏูุฉ ุญุณุงุจ ุนุฏุฏ ุงูููููุงุช ุงููุชููุนุฉ

### 2๏ธโฃ ุงูุนูุงูุงุช ุจูู ุงูุฌุฏุงูู (Foreign Keys)

ุฌููุน ุงูุนูุงูุงุช ูุญููุฉ ุจู Foreign Key Constraints:
- `ON DELETE CASCADE`: ุญุฐู ุชููุงุฆู ููุณุฌูุงุช ุงููุฑุชุจุทุฉ
- `ON DELETE SET NULL`: ุชุนููู ุงููููุฉ ุฅูู NULL ุนูุฏ ุงูุญุฐู

### 3๏ธโฃ ุงูู Indexes ุงููููุดุฃุฉ

ุชู ุฅูุดุงุก indexes ุนูู:
- ุฌููุน ุงูู Foreign Keys
- ุฃุนูุฏุฉ ุงูุจุญุซ ุงูุดุงุฆุนุฉ (barcode, status, etc.)
- ุฃุนูุฏุฉ ุงูุชูุงุฑูุฎ ูุชุณุฑูุน ุงูุชูุงุฑูุฑ

---

## ๐ ูุธุงู ุงูุจุงุฑููุฏ ุงููููุดุฃ ุชููุงุฆูุงู

| ุงููุฑุญูุฉ | ุงูุจุงุฏุฆุฉ | ูุซุงู |
|---------|---------|------|
| ุงููุณุชูุฏุน | WH | WH-001-2025 |
| ุงููุฑุญูุฉ 1 | ST1 | ST1-001-2025 |
| ุงููุฑุญูุฉ 2 | ST2 | ST2-001-2025 |
| ุงููุฑุญูุฉ 3 | CO3 | CO3-001-2025 |
| ุงููุฑุญูุฉ 4 | BOX4 | BOX4-001-2025 |

---

## โ๏ธ ุงููุนุงุฏูุงุช ุงูููุฏุฑุฌุฉ ุชููุงุฆูุงู

### 1. ูุนุงุฏูุฉ ุงููุฑุญูุฉ ุงูุฃููู (ุงูุชูุณูู):
```
ุงููุฒู_ุงููุณุชููู = ูุฒู_ุงูุงุณุชุงูุฏ + (ูุฒู_ุงูุงุณุชุงูุฏ ร ูุณุจุฉ_ุงููุฏุฑ รท 100)
```

### 2. ูุนุงุฏูุฉ ุงููุฑุญูุฉ ุงูุซุงููุฉ (ุงููุนุงูุฌุฉ):
```
ุงููุฒู_ุจุนุฏ_ุงููุนุงูุฌุฉ = ุงููุฒู_ุงููุฏุฎู ร (1 - ูุณุจุฉ_ุงููุฏุฑ รท 100)
```

### 3. ูุนุงุฏูุฉ ุงููุฑุญูุฉ ุงูุซุงูุซุฉ (ุงูููููุงุช):
```
ุนุฏุฏ_ุงูููููุงุช = floor(ุงููุฒู_ุงููุชุงุญ รท (ูุฒู_ุงููููู + ูุฒู_ุงูุตุจุบุฉ + ูุฒู_ุงูุจูุงุณุชูู + ูุฏุฑ_ุงููููู))
```

---

## ๐ ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช

ุงูุฃุฏูุงุฑ ุงููุชุงุญุฉ ูู ุฌุฏูู `users`:
- `admin` - ุงููุฏูุฑ ุงูุนุงู
- `manager` - ูุฏูุฑ ุงูุฅูุชุงุฌ
- `supervisor` - ุงููุดุฑู
- `worker` - ุงูุนุงูู

ุงููุฑุฏูุงุช ุงููุชุงุญุฉ:
- `morning` - ุงูุตุจุงุญูุฉ
- `evening` - ุงููุณุงุฆูุฉ
- `night` - ุงูููููุฉ

---

## ๐๏ธ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: Foreign Key Constraint Fails

**ุงูุณุจุจ**: ูุญุงููุฉ ุชุดุบูู migration ูุจู ุงูุฌุฏุงูู ุงููุฑุชุจุทุฉ ุจู

**ุงูุญู**: ุชุฃูุฏ ูู ุชุดุบูู ุงูู migrations ุจุงูุชุฑุชูุจ ุงูุตุญูุญ:
```bash
php artisan migrate:fresh
```

### ุฎุทุฃ: Table Already Exists

**ุงูุณุจุจ**: ุงูุฌุฏูู ููุฌูุฏ ูุณุจูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุญู**:
```bash
php artisan migrate:rollback
php artisan migrate
```

### ุฎุทุฃ: Syntax Error in SQL

**ุงูุณุจุจ**: ุฎุทุฃ ูู ุชุฑููุจ ุงูู SQL

**ุงูุญู**: ุชุญูู ูู ููู ุงูู migration ุงููุญุฏุฏ ูุชุฃูุฏ ูู ุตุญุฉ ุงูุชุฑููุจ

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ูุจู ุงูุชุดุบูู**: ุชุฃูุฏ ูู ุฅุนุฏุงุฏ ููู `.env` ุจุดูู ุตุญูุญ ูุน ุจูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

2. **ุงููุณุฎ ุงูุงุญุชูุงุทู**: ููุตุญ ุจุฃุฎุฐ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุจู ุชุดุบูู `migrate:fresh`

3. **ุงูุจูุฆุฉ ุงูุฅูุชุงุฌูุฉ**: ูุง ุชุณุชุฎุฏู `migrate:fresh` ูู ุงูุฅูุชุงุฌุ ุงุณุชุฎุฏู `migrate` ููุท

4. **ุงูุชุฎุตูุต**: ูููู ุชุนุฏูู ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ ูู ุงูู migrations ุญุณุจ ุงูุญุงุฌุฉ

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุจุนุฏ ุชุดุบูู ุงูู Migrations

1. ุฅูุดุงุก ุงูู Models ุงูููุงุจูุฉ ููู ุฌุฏูู
2. ุฅูุดุงุก ุงูู Seeders ูุฅุฏุฑุงุฌ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
3. ุฅูุดุงุก ุงูู Controllers ููุชุญูู ูู ุงูุจูุงูุงุช
4. ุฅูุดุงุก ุงูู API Routes
5. ุจูุงุก ุงููุงุฌูุงุช

---

## ๐ ููุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู ุฃุซูุงุก ุชุดุบูู ุงูู Migrationsุ ูุฑุฌู ุงูุชูุงุตู ูุน ูุฑูู ุงูุชุทููุฑ.

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** ููููุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0  
**ุงููุทูุฑ:** ูุฑูู ูุทูุฑู ูุธู ุงููุตุงูุน ุงูุฐููุฉ

---

โ **ุฌููุน ุงูู Migrations ุฌุงูุฒุฉ ููุชุดุบูู!**
