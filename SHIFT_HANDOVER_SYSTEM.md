# ๐ ูุธุงู ููู ุงููุฑุฏูุงุช ูุฅุฏุงุฑุฉ ุงูุนูู ุบูุฑ ุงูููุชูู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ูุฑู ูุฅุฏุงุฑุฉ ููู ุงูุนูู ุจูู ุงููุฑุฏูุงุช ูู ูุตูุน ุงูุญุฏูุฏุ ูุณูุญ ุจุชุชุจุน ุงูุนูููุงุช ุบูุฑ ุงูููุชููุฉ ูููููุง ูููุฑุฏูุงุช ุงูุชุงููุฉ ุฃู ุฅุนุงุฏุฉ ุฅุณูุงุฏูุง ูุนูุงู ุขุฎุฑูู.

---

## ๐ฏ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1๏ธโฃ **ุชุชุจุน ุงูุนูู ุบูุฑ ุงูููุชูู**
- ุนุฑุถ ุฌููุน ุงูุนูููุงุช ุงููุดุทุฉ (`is_active = true`) ูู ุตูุญุฉ ูุงุญุฏุฉ
- ููุชุฑุฉ ุญุณุจ:
  - ุงูุจุงุฑููุฏ
  - ุงููุฑุญูุฉ (Stage 1-4)
  - ุงูุนุงูู
  - ุงูุชุงุฑูุฎ (ูู - ุฅูู)

### 2๏ธโฃ **ุฅุนุงุฏุฉ ุงูุฅุณูุงุฏ (Reassignment)**
ูููู ุฅุนุงุฏุฉ ุฅุณูุงุฏ ุฃู ุนูููุฉ ูุดุทุฉ ูุนุงูู ุขุฎุฑ ูุน ุฎูุงุฑุงุช:

#### **ุฃ) ุฅุนุงุฏุฉ ุฅุณูุงุฏ ุนุงุฏูุฉ:**
```
ุงูุนุงูู ุงูุญุงูู โ ุงูุนุงูู ุงูุฌุฏูุฏ
ุงูุณุจุจ: ุชุบููุฑ ุนุงูู / ุงูุชูุงู ุฏุงุฎูู
status_before: 'reassigned'
```

#### **ุจ) ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ:**
```
ุงูุนุงูู ูู ุงููุฑุฏูุฉ A โ ุงูุนุงูู ูู ุงููุฑุฏูุฉ B
ุงูุณุจุจ: ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ
status_before: 'shift_transfer'
ุงูููุงุญุธุงุช: "ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ" (ุชูุถุงู ุชููุงุฆูุงู)
```

---

## ๐ง ุงููุฑููุงุช ุจูู ุงูููุนูู

| ุงูุฎุงุตูุฉ | ุฅุนุงุฏุฉ ุฅุณูุงุฏ ุนุงุฏูุฉ | ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ |
|---------|-------------------|---------------------|
| **ุงูุณุจุจ** | ุชุบููุฑ ุฏุงุฎูู / ุธุฑูู ุทุงุฑุฆุฉ | ููุงูุฉ ุงููุฑุฏูุฉ ูุงูุงูุชูุงู ูููุฑุฏูุฉ ุงูุชุงููุฉ |
| **status_before** | `reassigned` | `shift_transfer` |
| **ุงูููุงุญุธุงุช** | ุงุฎุชูุงุฑูุฉ ูู ุงููุณุชุฎุฏู | "ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ" (ุชููุงุฆู) |
| **ุงููุฏู** | ุชุบููุฑ ูุคูุช ุฃู ุทุงุฑุฆ | ูุธุงู ุฑูุชููู ูููู |
| **ุงูุชุชุจุน** | ูุธูุฑ ูุฅุนุงุฏุฉ ุฅุณูุงุฏ | ูุธูุฑ ูููู ูุฑุฏูุฉ |

---

## ๐ ุณูุฑ ุงูุนูู (Workflow)

### **ุงูุณููุงุฑูู 1: ุงูุนูู ุงูููุชูู ูู ููุณ ุงููุฑุฏูุฉ**
```
1. ุงูุนุงูู ูุจุฏุฃ ุงูุนูู โ worker_stage_history [is_active=true]
2. ุงูุนุงูู ูููู ุงูุนูู ูู ููุณ ุงููุฑุฏูุฉ
3. ุงููุธุงู ููููู ุงูุณุฌู ุชููุงุฆูุงู โ [is_active=false, status_after='completed']
4. ุงูุนูููุฉ ูุง ุชุธูุฑ ูู ุตูุญุฉ "ุงูุนูููุงุช ุบูุฑ ุงูููุชููุฉ"
```

### **ุงูุณููุงุฑูู 2: ุงูุนูู ูู ููุชูู - ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ**
```
1. ุงูุนุงูู ูุจุฏุฃ ุงูุนูู ูู ุงููุฑุฏูุฉ ุงูุตุจุงุญูุฉ
2. ุงูุนูู ูู ููุชูู ุนูุฏ ุงูุชูุงุก ุงููุฑุฏูุฉ
3. ุงููุดุฑู ููุชุญ ุตูุญุฉ "ุงูุนูููุงุช ุบูุฑ ุงูููุชููุฉ"
4. ูุถุบุท "ุฅุนุงุฏุฉ ุฅุณูุงุฏ" ุนูู ุงูุณุฌู
5. ูุฎุชุงุฑ ุงูุนุงูู ุงูุฌุฏูุฏ (ูู ุงููุฑุฏูุฉ ุงูุชุงููุฉ)
6. ูููุนูู ุฎูุงุฑ "ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ" โ
7. ุงููุธุงู:
   - ูููู ุณุฌู ุงููุฑุฏูุฉ ุงูุฃููู [is_active=false]
   - ููุดุฆ ุณุฌู ุฌุฏูุฏ ูููุฑุฏูุฉ ุงูุซุงููุฉ [is_active=true, status_before='shift_transfer']
   - ูุฑุณู ุฅุดุนุงุฑ ููุนุงูู ุงูุฌุฏูุฏ
```

### **ุงูุณููุงุฑูู 3: ุฅุนุงุฏุฉ ุฅุณูุงุฏ ุนุงุฏูุฉ (ุทุงุฑุฆุฉ)**
```
1. ุงูุนุงูู ูุจุฏุฃ ุงูุนูู
2. ูุญุฏุซ ุธุฑู ุทุงุฑุฆ (ูุฑุถ / ุงุณุชุฑุงุญุฉ / ุฅุนุงุฏุฉ ุชูุฒูุน)
3. ุงููุดุฑู ููุชุญ "ุงูุนูููุงุช ุบูุฑ ุงูููุชููุฉ"
4. ูุถุบุท "ุฅุนุงุฏุฉ ุฅุณูุงุฏ"
5. ูุฎุชุงุฑ ุงูุนุงูู ุงูุจุฏูู
6. ูุง ูููุนูู ุฎูุงุฑ "ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ"
7. ุงููุธุงู:
   - ูููู ุณุฌู ุงูุนุงูู ุงูุฃูู [is_active=false, status_after='reassigned']
   - ููุดุฆ ุณุฌู ููุนุงูู ุงูุฌุฏูุฏ [is_active=true, status_before='reassigned']
```

---

## ๐๏ธ ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### **ุฌุฏูู worker_stage_history**

```sql
CREATE TABLE worker_stage_history (
    id BIGINT PRIMARY KEY,
    stage_type VARCHAR(50),           -- stage1_stands, stage2_processed, stage3_coils, stage4_boxes
    stage_record_id BIGINT,           -- ID ุงูุณุฌู ูู ุฌุฏูู ุงููุฑุญูุฉ
    barcode VARCHAR(100),             -- ุจุงุฑููุฏ ุงูุนูููุฉ
    worker_id BIGINT,                 -- ุงูุนุงูู
    worker_type VARCHAR(20),          -- individual / team
    started_at DATETIME,              -- ููุช ุงูุจุฏุก
    ended_at DATETIME,                -- ููุช ุงูุงูุชูุงุก
    duration_minutes INT,             -- ุงููุฏุฉ ุจุงูุฏูุงุฆู
    is_active BOOLEAN,                -- ูุดุท / ููุชูู
    status_before VARCHAR(50),        -- ุงูุญุงูุฉ ูุจู: new, shift_transfer, reassigned
    status_after VARCHAR(50),         -- ุงูุญุงูุฉ ุจุนุฏ: completed, reassigned, delivered
    assigned_by BIGINT,               -- ูู ูุงู ุจุงูุชุนููู
    notes TEXT
);
```

### **ุงูุญุงูุงุช ุงููุณุชุฎุฏูุฉ:**

#### **status_before** (ุงูุญุงูุฉ ุนูุฏ ุงูุจุฏุงูุฉ):
- `new` - ุนูููุฉ ุฌุฏูุฏุฉ
- `shift_transfer` - ููู ูู ูุฑุฏูุฉ ุณุงุจูุฉ
- `reassigned` - ุฅุนุงุฏุฉ ุฅุณูุงุฏ ูู ุนุงูู ุขุฎุฑ

#### **status_after** (ุงูุญุงูุฉ ุนูุฏ ุงูุงูุชูุงุก):
- `completed` - ุงูุชููุช ุงูุนูููุฉ ุจูุฌุงุญ
- `reassigned` - ุฃูุนูุฏ ุฅุณูุงุฏูุง ูุนุงูู ุขุฎุฑ
- `delivered` - ุชู ุงูุชุณููู ุงูููุงุฆู (Stage 4)

---

## ๐ป ุงููุงุฌูุงุช (UI)

### **1. ุตูุญุฉ ุงูุนูููุงุช ุบูุฑ ุงูููุชููุฉ**
**ุงููุณุงุฑ:** `/manufacturing/pending-production`

#### **ุงูููุงุชุฑ:**
- ๐ ุงูุจุงุฑููุฏ
- ๐ ุงููุฑุญูุฉ (Stage 1-4)
- ๐ค ุงูุนุงูู
- ๐ ูู ุชุงุฑูุฎ
- ๐ ุฅูู ุชุงุฑูุฎ

#### **ุงูุฌุฏูู:**
| ุงูุจุงุฑููุฏ | ุงููุฑุญูุฉ | ุงูุนุงูู | ุชุงุฑูุฎ ุงูุจุฏุก | ุงููุฏุฉ | ุงูุฅุฌุฑุงุกุงุช |
|---------|---------|--------|-------------|-------|-----------|
| CO3-2025-001 | ุงููุฑุญูุฉ ุงูุซุงูุซุฉ | ุฃุญูุฏ | 2025-01-15 08:00 | 3 ุณุงุนุงุช | ๐ ุฅุนุงุฏุฉ ุฅุณูุงุฏ / ๐ ุงูุณุฌู |

### **2. ูุงูุฐุฉ ุฅุนุงุฏุฉ ุงูุฅุณูุงุฏ (Modal)**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ ุฅุนุงุฏุฉ ุฅุณูุงุฏ ุงูุณุฌู                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุงูุจุงุฑููุฏ: CO3-2025-001             โ
โ ุงูุนุงูู ุงูุญุงูู: ุฃุญูุฏ ูุญูุฏ            โ
โ                                     โ
โ ุงูุนุงูู ุงูุฌุฏูุฏ: [ูุงุฆูุฉ ููุณุฏูุฉ]      โ
โ                                     โ
โ โ ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ โจ          โ
โ   โ ูุนูู ูุฐุง ุงูุฎูุงุฑ ุฅุฐุง ููุช ุชุฑูุฏ   โ
โ     ููู ุงูุนูู ูููุฑุฏูุฉ ุงูุชุงููุฉ      โ
โ                                     โ
โ ุณุจุจ ุฅุนุงุฏุฉ ุงูุฅุณูุงุฏ:                 โ
โ [ุญูู ูุตู ุงุฎุชูุงุฑู]                  โ
โ                                     โ
โ ููุงุญุธุงุช:                           โ
โ [ุญูู ูุตู ุงุฎุชูุงุฑู]                  โ
โ                                     โ
โ        [ุฅูุบุงุก]    [ุญูุธ] โ         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### **3. ุตูุญุฉ ุณุฌู ุงูุชุนูููุงุช (History)**
**ุงููุณุงุฑ:** `/manufacturing/pending-production/{barcode}/history`

**Timeline ุนุฑุถ ุฒููู:**
```
โ 2025-01-15 08:00 - ุฃุญูุฏ ูุญูุฏ
   ุงููุฑุญูุฉ: ุงูุซุงูุซุฉ - ุงูููุงุฆู
   ุงูุญุงูุฉ: ูุดุท
   ุงููุฏุฉ: 3 ุณุงุนุงุช ู 25 ุฏูููุฉ

โ 2025-01-15 04:30 - ูุญูุฏ ุนูู
   ุงููุฑุญูุฉ: ุงูุซุงููุฉ - ุงููุนุงูุฌ
   ุงูุญุงูุฉ: ููุชูู โ ููู ูููุฑุญูุฉ ุงูุชุงููุฉ
   ุงููุฏุฉ: 4 ุณุงุนุงุช

โ 2025-01-15 00:00 - ุฎุงูุฏ ุณุงูู
   ุงููุฑุญูุฉ: ุงูุฃููู - ุงูุงุณุชุงูุฏ
   ุงูุญุงูุฉ: ููุชูู โ ููุชูู
   ุงููุฏุฉ: 5 ุณุงุนุงุช ู 15 ุฏูููุฉ
   ููุงุญุธุงุช: ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ
```

---

## ๐ ุงูุตูุงุญูุงุช ุงููุทููุจุฉ

```php
// ูููุตูู ูุตูุญุฉ ุงูุนูููุงุช ุบูุฑ ุงูููุชููุฉ
'MENU_QUALITY'

// ูุฅุนุงุฏุฉ ุงูุฅุณูุงุฏ (ููุณ ุงูุตูุงุญูุฉ)
'MENU_QUALITY'
```

---

## ๐ ุฃูุซูุฉ ุงุณุชุฎุฏุงู

### **ูุซุงู 1: ูุดุฑู ูููู ุนูู ูููุฑุฏูุฉ ุงูุชุงููุฉ**

**ุงููุถุน:** ุงูุชูุช ุงููุฑุฏูุฉ ุงูุตุจุงุญูุฉ ูุงูุนุงูู "ุฃุญูุฏ" ูุงู ูุนูู ุนูู ูููู ูู ููุชูู.

**ุงูุฅุฌุฑุงุกุงุช:**
1. ุงููุดุฑู ููุชุญ "ุงูุนูููุงุช ุบูุฑ ุงูููุชููุฉ"
2. ูุฌุฏ ุณุฌู ุงููููู `CO3-2025-007` ูููู ูู "ุฃุญูุฏ"
3. ูุถุบุท "ุฅุนุงุฏุฉ ุฅุณูุงุฏ"
4. ูุฎุชุงุฑ "ูุญูุฏ" (ุนุงูู ุงููุฑุฏูุฉ ุงููุณุงุฆูุฉ)
5. **ูููุนูู** โ๏ธ "ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ"
6. ูุถูู ููุงุญุธุฉ: "ูู ููุชูู ูู ุงููุฑุฏูุฉ ุงูุตุจุงุญูุฉ"
7. ูุถุบุท "ุญูุธ"

**ุงููุชูุฌุฉ:**
- ุณุฌู "ุฃุญูุฏ" ููููู: `status_after = 'reassigned'`
- ุณุฌู ุฌุฏูุฏ ูู "ูุญูุฏ": `status_before = 'shift_transfer'`
- "ูุญูุฏ" ูุณุชูู ุฅุดุนุงุฑ: "ุชู ุฅุณูุงุฏ ุงูุนูู ุนูู ุงูุจุงุฑููุฏ CO3-2025-007..."

---

### **ูุซุงู 2: ุฅุนุงุฏุฉ ุฅุณูุงุฏ ุทุงุฑุฆุฉ**

**ุงููุถุน:** ุงูุนุงูู "ุฎุงูุฏ" ุฃุตุงุจู ุชุนุจ ูุฌุฃุฉ ุฃุซูุงุก ุงูุนูู.

**ุงูุฅุฌุฑุงุกุงุช:**
1. ุงููุดุฑู ููุชุญ "ุงูุนูููุงุช ุบูุฑ ุงูููุชููุฉ"
2. ูุฌุฏ ุณุฌู `BOX4-2025-012` ูููู ูู "ุฎุงูุฏ"
3. ูุถุบุท "ุฅุนุงุฏุฉ ุฅุณูุงุฏ"
4. ูุฎุชุงุฑ "ุณุงูู" (ุนุงูู ุจุฏูู)
5. **ูุง ูููุนูู** โ "ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ"
6. ูุถูู ุณุจุจ: "ุงูุนุงูู ุฃุตุงุจู ุชุนุจ"
7. ูุถุบุท "ุญูุธ"

**ุงููุชูุฌุฉ:**
- ุณุฌู "ุฎุงูุฏ" ููููู: `status_after = 'reassigned'`
- ุณุฌู ุฌุฏูุฏ ูู "ุณุงูู": `status_before = 'reassigned'`
- ููุงููุง ูุณุชููุงู ุฅุดุนุงุฑุงุช

---

## ๐ ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช

ูููู ุงุณุชุฎุฑุงุฌ ุชูุงุฑูุฑ ูููุฏุฉ ูู ุงูุจูุงูุงุช:

### **1. ูุนุฏู ููู ุงููุฑุฏูุงุช:**
```sql
SELECT 
    DATE(started_at) as date,
    COUNT(*) as shift_transfers
FROM worker_stage_history
WHERE status_before = 'shift_transfer'
GROUP BY DATE(started_at)
ORDER BY date DESC;
```

### **2. ุงูุนูุงู ุงูุฃูุซุฑ ุงุณุชูุงูุงู ููุนูู ุงูููููู:**
```sql
SELECT 
    u.name,
    COUNT(*) as received_transfers
FROM worker_stage_history wsh
JOIN users u ON wsh.worker_id = u.id
WHERE wsh.status_before = 'shift_transfer'
GROUP BY u.id
ORDER BY received_transfers DESC
LIMIT 10;
```

### **3. ุงููุฑุงุญู ุงูุฃูุซุฑ ูููุงู ุจูู ุงููุฑุฏูุงุช:**
```sql
SELECT 
    stage_type,
    COUNT(*) as transfer_count
FROM worker_stage_history
WHERE status_before = 'shift_transfer'
GROUP BY stage_type
ORDER BY transfer_count DESC;
```

---

## โ ุงูุฅุตูุงุญุงุช ุงููููุฐุฉ

### **1. ุฅุตูุงุญ ูุดููุฉ ุฅุนุงุฏุฉ ุงูุชุนููู**
**ุงููุดููุฉ:** FormData ูู ุชูุฑุณู ุจุดูู ุตุญูุญ
**ุงูุญู:** ุชุบููุฑ ุฅูู JSON body:
```javascript
fetch(url, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRF-TOKEN': token
    },
    body: JSON.stringify(formData)
})
```

### **2. ุฅููุงุก ุณุฌู ุงููุฑุญูุฉ ุงูุฑุงุจุนุฉ ุนูุฏ ุงูุชุณููู**
**ุงููุดููุฉ:** ุณุฌูุงุช Stage 4 ุชุจูู ูุดุทุฉ ุจุนุฏ ุงูุชุณููู ุงูููุงุฆู
**ุงูุญู:** ุฅุถุงูุฉ ููุฏ ุฅููุงุก ุงูุณุฌู ูู `FinishedProductDeliveryController`:
```php
\App\Models\WorkerStageHistory::where('stage_type', STAGE_4_BOXES)
    ->where('stage_record_id', $stage4Box->id)
    ->where('is_active', true)
    ->update([
        'is_active' => false,
        'ended_at' => now(),
        'status_after' => 'delivered'
    ]);
```

### **3. ุฅุถุงูุฉ ุฎูุงุฑ ููู ุงููุฑุฏูุฉ**
**ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ:** Checkbox ูู ูุงูุฐุฉ ุฅุนุงุฏุฉ ุงูุฅุณูุงุฏ
```html
<input type="checkbox" id="shift_transfer" name="shift_transfer">
<label>ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ</label>
```

---

## ๐ ุฃูุถู ุงูููุงุฑุณุงุช

### **ูููุดุฑููู:**
1. โ ุงุณุชุฎุฏู "ููู ูููุฑุฏูุฉ ุงูุชุงููุฉ" ุนูุฏ ููุงูุฉ ูู ูุฑุฏูุฉ
2. โ ุฑุงุฌุน ุตูุญุฉ "ุงูุนูููุงุช ุบูุฑ ุงูููุชููุฉ" ูุจู ุงูุชูุงุก ูู ูุฑุฏูุฉ
3. โ ุฃุถู ููุงุญุธุงุช ูุงุถุญุฉ ููู ููู
4. โ๏ธ ูุง ุชุชุฑู ุนูููุงุช ูุนููุฉ ุจุฏูู ูุชุงุจุนุฉ

### **ููุฅุฏุงุฑุฉ:**
1. ๐ ุฑุงูุจ ุชูุงุฑูุฑ ููู ุงููุฑุฏูุงุช ููููุงู
2. ๐ ุญูู ุงูุฃุณุจุงุจ ุงููุชูุฑุฑุฉ ูุนุฏู ุงูุงูุชูุงู
3. ๐ฏ ุญุฏุฏ ุงูุฃูุฏุงู ูุชูููู ูุณุจุฉ ุงูููู ุจูู ุงููุฑุฏูุงุช
4. ๐ฅ ุชุฃูุฏ ูู ุชูุฒูุน ุงูุนูู ุจุงูุชุณุงูู ุจูู ุงูุนูุงู

---

## ๐ ุงูุฏุนู ุงูููู

ููุงุณุชูุณุงุฑุงุช ุฃู ุงููุดุงูู ุงูุชูููุฉ:
- ๐ง ุงูุจุฑูุฏ: support@ironfactory.com
- ๐ฑ ุงููุงุชู: +123456789
- ๐ฌ ุงูุฏุนู ุงููุจุงุดุฑ ูู ุงููุธุงู

---

**ุชู ุงูุชุทููุฑ:** ุฏูุณูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0  
**ุงูุญุงูุฉ:** โ ูุดุท ูููุนูู