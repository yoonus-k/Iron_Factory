# ุชุญุฏูุซ ููู ุงููุฑุญูุฉ ุจูู ุงููุฑุฏูุงุช ๐

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

ุชู ุชุญุฏูุซ ุฏุงูุฉ `transferStageToShift` ูู `WorkerTrackingController` ูุชุทุจูู ุงูุชุบููุฑุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุนูุฏ ููู ุงููุฑุญูุฉ (ุงูุณุชุงูุฏ) ูู ูุฑุฏูุฉ ุฅูู ุฃุฎุฑู.

---

## โจ ูุง ุชู ุชุญุฏูุซู

### 1. **ุชุญุฏูุซ ุงูุณุชุงูุฏ (ุงููุฑุญูุฉ) ููุณู**
```php
$stand->update([
    'status' => 'in_process',  // ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู ููุฏ ุงููุนุงูุฌุฉ
]);
```
- ุชุบููุฑ ุญุงูุฉ ุงูุณุชุงูุฏ ูู `created` ุฅูู `in_process`
- ูุนูุณ ุฃู ุงููุฑุญูุฉ ุงูุขู ููุฏ ุงููุนุงูุฌุฉ ูู ุงููุฑุฏูุฉ ุงูุฌุฏูุฏุฉ

### 2. **ุชุญุฏูุซ ุงููุฑุฏูุฉ ุงูุฌุฏูุฏุฉ**
```php
$toShift->update([
    'stage_record_id' => $stand->id,
    'stage_record_barcode' => $stand->barcode,
]);
```
- ุฑุจุท ุงูุณุชุงูุฏ ุจุงููุฑุฏูุฉ ุงูุฌุฏูุฏุฉ
- ุชุฎุฒูู ุฑูู ุงูุณุชุงูุฏ ูุงูุจุงุฑููุฏ ูู ุจูุงูุงุช ุงููุฑุฏูุฉ

### 3. **ุชุณุฌูู ูู ุฌุฏูู ุงูุชุชุจุน**
```php
DB::table('product_tracking')->insert([
    'barcode' => $stand->barcode,
    'product_type' => 'stage1_stand',
    'product_id' => $stand->id,
    'stage' => 'stage1',
    'action' => 'transfer_shift',
    ...
]);
```
- ุชุณุฌูู ูุงูู ูุนูููุฉ ุงูููู
- ุญูุธ ุจูุงูุงุช ุงููุฑุฏูุฉ ุงูุฃุตููุฉ ูุงูุฌุฏูุฏุฉ

### 4. **ููู ุชุชุจุน ุงูุนูุงู**
```php
// ุฅููุงุก ุงูุชุชุจุน ูู ุงููุฑุฏูุฉ ุงูุฃุตููุฉ
WorkerStageHistory::where(...)->update([
    'ended_at' => now(),
    'is_active' => false,
]);

// ุฅุถุงูุฉ ุชุชุจุน ุฌุฏูุฏ ูููุฑุฏูุฉ ุงูุฌุฏูุฏุฉ
WorkerStageHistory::create([...]);
```
- ุฅููุงุก ุชุชุจุน ุงูุนูุงู ูู ุงููุฑุฏูุฉ ุงูุฃุตููุฉ
- ุฅุถุงูุฉ ุชุชุจุน ุฌุฏูุฏ ูุนูุงู ุงููุฑุฏูุฉ ุงูุฌุฏูุฏุฉ

### 5. **ุชุณุฌูู ุงูุนูููุฉ ูู ShiftOperationLog**
```php
ShiftOperationLog::create([
    'operation_type' => 'transfer_stage',
    'old_data' => [...],
    'new_data' => [...],
]);
```
- ุญูุธ ุณุฌู ุงูุนูููุฉ ูุน ุงูุจูุงูุงุช ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ

---

## ๐ ุณูุฑ ุงูุนูููุฉ

ุนูุฏ ููู ุงููุฑุญูุฉ ูู ูุฑุฏูุฉ ุฅูู ุฃุฎุฑู:

1. โ **ุชุญุฏูุซ ุงูุณุชุงูุฏ**: ุชุบููุฑ ุงูุญุงูุฉ ูู `created` ุฅูู `in_process`
2. โ **ุชุญุฏูุซ ุงููุฑุฏูุฉ ุงูุฌุฏูุฏุฉ**: ุฅุถุงูุฉ ูุนุฑู ุงูุณุชุงูุฏ ูุงูุจุงุฑููุฏ
3. โ **ุชุณุฌูู ุงูุชุชุจุน**: ุญูุธ ูู ุฌุฏูู `product_tracking`
4. โ **ููู ุชุชุจุน ุงูุนูุงู**: ุฅููุงุก ุงูุชุชุจุน ุงููุฏูู ูุฅุถุงูุฉ ุฌุฏูุฏ
5. โ **ุชุณุฌูู ุงูุนูููุฉ**: ุญูุธ ูู ุฌุฏูู `shift_operation_logs`

---

## ๐ ุงูุจูุงูุงุช ุงููุญููุธุฉ

### ูู ุฌุฏูู `stage1_stands`:
- `status` โ ูู `created` ุฅูู `in_process`

### ูู ุฌุฏูู `shift_assignments`:
- `stage_record_id` โ ูุนุฑู ุงูุณุชุงูุฏ
- `stage_record_barcode` โ ุจุงุฑููุฏ ุงูุณุชุงูุฏ

### ูู ุฌุฏูู `product_tracking`:
- `barcode` - ุงูุจุงุฑููุฏ
- `action` - `transfer_shift`
- `old_value` - ุฑูุฒ ุงููุฑุฏูุฉ ุงูุฃุตููุฉ
- `new_value` - ุฑูุฒ ุงููุฑุฏูุฉ ุงูุฌุฏูุฏุฉ
- `details` - ุจูุงูุงุช JSON ุจุงููุนูููุงุช ุงููุงููุฉ

### ูู ุฌุฏูู `worker_stage_history`:
- ุฅููุงุก ุงูุณุฌูุงุช ุงููุดุทุฉ ูููุฑุฏูุฉ ุงูุฃุตููุฉ
- ุฅุถุงูุฉ ุณุฌูุงุช ุฌุฏูุฏุฉ ูููุฑุฏูุฉ ุงูุฌุฏูุฏุฉ

### ูู ุฌุฏูู `shift_operation_logs`:
- `operation_type` - `transfer_stage`
- `old_data` - ุฌููุน ุงูุจูุงูุงุช ุงููุฏููุฉ
- `new_data` - ุฌููุน ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ

---

## ๐ ุงูุฃูุงู ูุงูููุซูููุฉ

- โ ุงุณุชุฎุฏุงู `DB::beginTransaction()` ู `DB::commit()`
- โ ุงุณุชุฑุฌุงุน ุชููุงุฆู ุนูุฏ ุญุฏูุซ ุฎุทุฃ (`DB::rollBack()`)
- โ ุชุณุฌูู ุฌููุน ุงูุฃุฎุทุงุก ูู `Log`
- โ ูุนุงูุฌุฉ ุงูุงุณุชุซูุงุกุงุช ุจุดูู ุขูู
- โ ุชุญูู ูู ุนุฏู ูุฌูุฏ ุชุชุจุน ููุฑุฑ ููุนูุงู

---

## ๐ ุงูุงุณุชุฎุฏุงู

ุงูุฏุงูุฉ ุชุณุชูุจู ูุนุงููุงุช JSON:

```json
{
  "stand_id": 1,
  "from_shift_id": 5,
  "to_shift_id": 10,
  "notes": "ุชู ุงูููู ูุฃุณุจุงุจ ุชูุธูููุฉ"
}
```

ุงูุงุณุชุฌุงุจุฉ:

```json
{
  "success": true,
  "message": "โ ุชู ููู ุงููุฑุญูุฉ ST-001 ุจูุฌุงุญ ูู ุงููุฑุฏูุฉ SH-M-20250101-001 ุฅูู ุงููุฑุฏูุฉ SH-M-20250101-002",
  "data": {
    "stand_id": 1,
    "stand_number": "ST-001",
    "stand_barcode": "ST1-001-2025",
    "stand_status": "in_process",
    "from_shift": {...},
    "to_shift": {...}
  }
}
```

---

## ๐ฏ ุงููุฒุงูุง

| ุงูููุฒุฉ | ุงููุงุฆุฏุฉ |
|--------|---------|
| **ุชุญุฏูุซ ุชููุงุฆู** | ุฌููุน ุงูุจูุงูุงุช ุชูุญุฏููุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช |
| **ุชุชุจุน ูุงูู** | ุฌููุน ุงูุชุบููุฑุงุช ูุณุฌูุฉ ููุชุชุจุนุฉ |
| **ููุซูููุฉ ุนุงููุฉ** | ุงุณุชุฎุฏุงู ุงููุนุงููุงุช (Transactions) |
| **ุชูุซูู ุดุงูู** | ุฌููุน ุงูุนูููุงุช ูุณุฌูุฉ ูู ุงูุณุฌูุงุช |
| **ุณูููุฉ ุงููุฑุงุฌุนุฉ** | ูููู ูุฑุงุฌุนุฉ ุชุงุฑูุฎ ูู ููู |

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

- `Modules/Manufacturing/Http/Controllers/WorkerTrackingController.php`
  - ุฏุงูุฉ `transferStageToShift()`
  - ุงุณุชูุฑุงุฏ `DB` ู `Log`

---

## ๐ ููุงุญุธุงุช

- ุฌููุน ุงูุชุบููุฑุงุช ุชูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุฑุงู
- ูููู ุงููุฑุงุฌุนุฉ ุนุจุฑ ุฌุฏูู `shift_operation_logs`
- ูููู ุชุชุจุน ุชุงุฑูุฎ ุงูุณุชุงูุฏ ุนุจุฑ ุฌุฏูู `product_tracking`
- ุฌููุน ุนูููุงุช ุงูููู ุขููุฉ ูููุซููุฉ
